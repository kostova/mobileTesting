function FindIpAddress(){var a=os.networkInterfaces();for(var b in a)for(var c=0;c<a[b].length;c++){var d=a[b][c];if("IPv4"===d.family&&!d.internal&&-1===b.indexOf("Windows Phone")||1===a[b].length)return d.address}return"127.0.0.1"}function ForkChildProcess(a,b,c,d,e){var f=null;try{f=childProcess.fork(a,b,{cwd:path.join(__dirname,c)})}catch(g){e(g.message,null)}f.on("message",function(a){"connected"===a&&e(null,f)}),f.on("exit",d)}function HandleError(a){a&&(console.log(a),process.exit(1))}function OnMessageServerExit(a){0!==a&&(console.log("Message server encountered an error and will disconnect."),testrunnerServer&&process.kill(testrunnerServer.pid,"SIGINT"),process.exit(1))}function OnRunnerExit(a){0!==a&&(console.log("Test Runner / Agent server encountered an error and will disconnect."),messageServer&&process.kill(messageServer.pid,"SIGINT"),process.exit(1))}function LaunchServers(a,b,c,d,e){var f=FindIpAddress(),g=["--message-server-address","ws://"+f+":"+a,"--timeout",c,"--test-runner-port",b];d||g.push("--skip-open");var h=[a,c,e];ForkChildProcess("server.js",h,"../node_modules/server/",OnMessageServerExit,function(c,e){HandleError(c),messageServer=e,ForkChildProcess("main.js",g,"../node_modules/runner/",OnRunnerExit,function(c,e){HandleError(c),testrunnerServer=e,d&&console.log("Test Runner available at http://"+f+":"+b+"/testrunner"),console.log("Web Agent available at http://"+f+":"+b+"/"),console.log("Message Server available at ws://"+f+":"+a),console.log("")})}),process.stdin.resume()}var os=require("os"),path=require("path"),childProcess=require("child_process"),messageServer,testrunnerServer,serverCommand={execute:function(a){LaunchServers(a.messageServerPort,a.testRunnerPort,a.messageTimeout,a.launchTestRunner,a.verbose)}};module.exports=serverCommand;