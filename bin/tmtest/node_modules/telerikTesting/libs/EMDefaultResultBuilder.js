function EMDefaultResultBuilder(){this.screenshotCallback=function(){}}function createStatisticsEntry(a,b,c){return{passed:a,failed:b,skipped:c}}function createStepStatistics(a){var b={operationStats:createStatisticsEntry(0,0,0)};for(ii=0;ii<a.length;ii++)switch(a[ii].status){case"PASS":b.operationStats.passed++;break;case"FAIL":b.operationStats.failed++;break;case"SKIP":b.operationStats.skipped++}return b}function createTestStatistics(a){var b={stepStats:createStatisticsEntry(0,0,0),operationStats:createStatisticsEntry(0,0,0)};for(ii=0;ii<a.length;ii++){switch(a[ii].status){case"PASS":b.stepStats.passed++;break;case"FAIL":b.stepStats.failed++;break;case"SKIP":b.stepStats.skipped++}b.operationStats.passed+=a[ii].statistics.operationStats.passed,b.operationStats.failed+=a[ii].statistics.operationStats.failed,b.operationStats.skipped+=a[ii].statistics.operationStats.skipped}return b}function createSuiteStatistics(a){var b={testStats:createStatisticsEntry(0,0,0),stepStats:createStatisticsEntry(0,0,0),operationStats:createStatisticsEntry(0,0,0)};for(ii=0;ii<a.length;ii++){switch(a[ii].status){case"PASS":b.testStats.passed++;break;case"FAIL":b.testStats.failed++;break;case"SKIP":b.testStats.skipped++}b.stepStats.passed+=a[ii].statistics.stepStats.passed,b.stepStats.failed+=a[ii].statistics.stepStats.failed,b.stepStats.skipped+=a[ii].statistics.stepStats.skipped,b.operationStats.passed+=a[ii].statistics.operationStats.passed,b.operationStats.failed+=a[ii].statistics.operationStats.failed,b.operationStats.skipped+=a[ii].statistics.operationStats.skipped}return b}function createAgentsStatistics(a){var b={suiteStats:createStatisticsEntry(0,0,0),testStats:createStatisticsEntry(0,0,0),stepStats:createStatisticsEntry(0,0,0),operationStats:createStatisticsEntry(0,0,0)};for(ii=0;ii<a.length;ii++){switch(a[ii].status){case"PASS":b.suiteStats.passed++;break;case"FAIL":b.suiteStats.failed++;break;case"SKIP":b.suiteStats.skipped++}b.testStats.passed+=a[ii].statistics.testStats.passed,b.testStats.failed+=a[ii].statistics.testStats.failed,b.testStats.skipped+=a[ii].statistics.testStats.skipped,b.stepStats.passed+=a[ii].statistics.stepStats.passed,b.stepStats.failed+=a[ii].statistics.stepStats.failed,b.stepStats.skipped+=a[ii].statistics.stepStats.skipped,b.operationStats.passed+=a[ii].statistics.operationStats.passed,b.operationStats.failed+=a[ii].statistics.operationStats.failed,b.operationStats.skipped+=a[ii].statistics.operationStats.skipped}return b}function createStatistics(a,b){return"STEP"==a?createStepStatistics(b):"TEST"==a?createTestStatistics(b):"SUITE"==a?createSuiteStatistics(b):"AGENT"==a?createAgentsStatistics(b):null}function createAssertionErrorResultObject(a){return{method:a.method,actual:JSON.stringify(a.actual),expected:JSON.stringify(a.expected),params:JSON.stringify(a.params),isNot:a.isNot,message:a.message}}function defaultException(){return{name:"Unknown Exception",message:"",stack:""}}function isFrameworkException(a){return a&&a.error&&a.error.code&&a.error.description?{name:"Framework Exception",message:a.error.code+": "+a.error.description,stack:""}:!1}function isJavascriptException(a){return a&&a.name&&a.message&&a.stack?{name:a.name,message:a.message,stack:a.stack}:!1}function isStringException(a){return"string"==typeof a?{name:"String Exception",message:a,stack:""}:!1}function isUserException(a){return"object"==typeof a?{name:"User Exception",message:JSON.stringify(a),stack:""}:!1}function createExceptionResultObject(a){return isStringException(a)||isFrameworkException(a)||isJavascriptException(a)||isUserException(a)||defaultException()}function handleExceptionResult(a){return a&&a.assertionError?{type:"ASSERTIONERROR",value:createAssertionErrorResultObject(a.assertionError)}:{type:"EXCEPTION",value:createExceptionResultObject(a)}}function createApiResult(a,b,c,d,e,f){var g="";e.screenshot&&(g=utils.uuid()+".png",f(g,e.screenshot));var h={type:"Unknown",value:"Unknown"};return"undefined"!=typeof e&&e&&e.type&&e.value&&("EXCEPTION"===e.type?h=handleExceptionResult(e.value):("REASON"===e.type||"INVALID_AGENT"===e.type)&&(h.type=e.type,h.value="string"==typeof e.value?e.value:JSON.stringify(e.value))),{name:b.name,type:b.type,status:a,details:h,screenshot:g,startTime:c,endTime:d,version:VERSION}}function createResult(a,b,c,d,e,f){var g=createStatistics(c.type,f);return"AGENT"===c.type?createAgentResult(a,c,d,e,f,g):{name:c.name,type:c.type,status:a,results:f,startTime:d,endTime:e,version:VERSION,statistics:g}}function createAgentResult(a,b,c,d,e,f){return{agent:{id:b.agent.id,platformKey:b.agent.platformInfo.platformKey,platformInfo:b.agent.platformInfo},type:b.type,status:a,results:e,startTime:c,endTime:d,version:VERSION,statistics:f}}var logger=require("./logger.js"),utils=require("./utils.js"),VERSION="1.1";EMDefaultResultBuilder.prototype={constructor:EMDefaultResultBuilder,pass:function(a,b,c,d,e){return createApiResult("PASS",b,c,d,e,this.screenshotCallback)},skip:function(a,b,c,d,e){return createApiResult("SKIP",b,c,d,e,this.screenshotCallback)},fail:function(a,b,c,d,e){return createApiResult("FAIL",b,c,d,e,this.screenshotCallback)},passWithResults:function(a,b,c,d,e){return createResult("PASS",a,b,c,d,e)},skipWithResults:function(a,b,c,d,e){return createResult("SKIP",a,b,c,d,e)},failWithResults:function(a,b,c,d,e){return createResult("FAIL",a,b,c,d,e)}},module.exports=EMDefaultResultBuilder;