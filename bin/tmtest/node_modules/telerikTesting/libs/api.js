function TSNode(a,b){this.type=a,this.name=b,this.parent=null,this.children=[]}function Operation(a,b,c,d){this.platformKey=a,this.name=b,this.setupFunc=c,this.operationFunc=d}function EMResultContainer(a,b,c){this.status=a,this.outputResult=b,this.stopTestRun=c}function isResponseValid(a){return!!(a&&a.result&&a.result.code&&a.result.reason)}function createOperation(a,b,c,d){return new Operation(a,b,c,d)}function createCommand(a,b,c,d,e){var f=function(a){return function(b,c){return c.sendMessage(a.message,a.options).then(function(a){if(!isResponseValid(a))return FAIL(createResult(ApiProtocol.resultTypes.REASON,"Invalid response receieved from agent.",c.getScreenshot(a)));if(a.result.code===ApiProtocol.responseCodes.SUCCESS)try{return d?d(c,a):PASS(createResult(ApiProtocol.resultTypes.REASON,a.result.reason,c.getScreenshot(a)))}catch(b){return FAIL(createResult(ApiProtocol.resultTypes.EXCEPTION,b,c.getScreenshot(a)))}else try{return e?e(c,a):FAIL(createResult(ApiProtocol.resultTypes.REASON,a.result.reason,c.getScreenshot(a)))}catch(b){return FAIL(createResult(ApiProtocol.resultTypes.EXCEPTION,b,c.getScreenshot(a)))}})}};return createOperation(a,b,c,f)}function createResult(a,b,c){return{type:a,value:b,screenshot:c}}function ValidateArgument(a,b,c,d,e,f){if(null===a||void 0===a){if(d)return!1;throw new Error('Argument "'+c+'" cannot be undefined or null.')}var g=typeof a;if(g!==b)throw new Error('Argument "'+c+'" should be of type '+b+", not "+g+".");if("number"===b){if(null!==e&&void 0!==e&&e>a)throw null!==f&&void 0!==f?new Error('Argument "'+c+'" should be a value greater than or equal to '+e+" and less than or equal to "+f+"."):new Error('Argument "'+c+'" should be a value greater than or equal to '+e+".");if(null!==f&&void 0!==f&&a>f)throw null!==e&&void 0!==e?new Error('Argument "'+c+'" should be a value greater than or equal to '+e+" and less than or equal to "+f+"."):new Error('Argument "'+c+'" should be a value less than or equal to '+f+".")}return!0}function ValidateArrayElements(a,b,c){if(!Array.isArray(a))throw new Error('Argument "'+c+'" should be array, not '+typeof a+".");a.forEach(function(a){if(typeof a!==b)throw new Error('Argument "'+c+'" should contain only elements of type '+b)})}var Q=require("./q.js"),ApiProtocol=require("./ApiProtocol.js"),TsAutomationProtocol=require("./TsAutomationProtocol.js");TSNode.prototype={constructor:TSNode,getChildren:function(){return this.children},addChild:function(a){a.parent=this,this.children.push(a)}},Operation.prototype={constructor:Operation,postSetup:function(a,b){return a.tryWrapAutomateWeb(this,b)},execute:function(a,b){return Q().then(function(){if(!b.validatePlatformKey(this.platformKey))return FAIL(createResult(ApiProtocol.resultTypes.INVALID_AGENT,"Operation for "+this.platformKey+" could not execute on "+b.platformInfo.platformKey));var c=this.setupFunc(b);c=this.postSetup(b,c);var d=this.operationFunc(c);return Q.spread([a,b],d)}.bind(this)).fail(function(a){return FAIL(createResult(ApiProtocol.resultTypes.EXCEPTION,a))})}},EMResultContainer.prototype={constructor:EMResultContainer,isPass:function(){return this.status===ApiProtocol.statuses.PASS},isSkip:function(){return this.status===ApiProtocol.statuses.SKIP},isFail:function(){return this.status===ApiProtocol.statuses.FAIL},isFailAndCannotContinue:function(){return this.outputResult&&this.outputResult.type&&this.outputResult.type===ApiProtocol.resultTypes.EXCEPTION&&this.outputResult.value&&this.outputResult.value.error&&this.outputResult.value.code&&(this.outputResult.value.error.code===TsAutomationProtocol.errors.RECIPIENT_NOT_FOUND.code||this.outputResult.value.error.code===TsAutomationProtocol.errors.RECIPIENT_VERSION_MISMATCH.code)?!0:!1}};var PASS=function(a,b){return new EMResultContainer(ApiProtocol.statuses.PASS,a,b)},SKIP=function(a,b){return new EMResultContainer(ApiProtocol.statuses.SKIP,a,b)},FAIL=function(a,b){return new EMResultContainer(ApiProtocol.statuses.FAIL,a,b)},api={TSNode:TSNode,Operation:Operation,ValidateArgument:ValidateArgument,ValidateArrayElements:ValidateArrayElements,createOperation:createOperation,createCommand:createCommand,createResult:createResult,isResponseValid:isResponseValid,PASS:PASS,SKIP:SKIP,FAIL:FAIL};module.exports=api;